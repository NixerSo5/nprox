<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nixer.nprox.dao.SwarmDao">
<!--    <insert id="saveUserNode" parameterType="com.nixer.nprox.entity.swarm.SwarmUserNode" useGeneratedKeys="true" keyProperty="id">-->
<!--        insert into swarm_user_nodes ( `userid`, `node_uid`) VALUES ( #{userid}, #{node_uid});-->
<!--    </insert>-->
    <delete id="delUserNode">
        delete FROM swarm_user_nodes  where userid='${userid}'  AND node_uid = '${node_uid}'
    </delete>
    <select id="getSwarmDayLastSevenDay" resultType="com.nixer.nprox.entity.swarm.SwarmDay">
        SELECT *
        FROM swarm_day
        ORDER BY ctime desc LIMIT 1,8
    </select>
    <select id="getSwarmUserTotal" resultType="com.nixer.nprox.entity.swarm.SwarmUserTotal">
        select *
        from swarm_user_total
        where userid = #{id}
    </select>
    <select id="getSwarmUserDay" resultType="com.nixer.nprox.entity.swarm.SwarmUserDayExt">
        select *
        from swarm_user_day
        where userid = '${userid}' and date = '${date}'
    </select>
    <select id="getUserNodesState" resultType="com.nixer.nprox.entity.swarm.PoolNodes">
        SELECT COUNT(*) as num, SN.state
        FROM swarm_nodes SN
                 LEFT JOIN swarm_user_nodes SUN ON SN.id = SUN.node_uid
        WHERE SUN.userid = #{userid}
        GROUP BY SN.state
    </select>
    <select id="getSwarmDay" resultType="com.nixer.nprox.entity.swarm.SwarmDay">
        SELECT *
        from swarm_day
        where update_date = #{date}
    </select>
    <select id="userPoolStateLine" resultType="com.nixer.nprox.entity.swarm.UserSwarmLine">
        SELECT SUD.date as date,
	SUD.bzz as user_bzz,
	SUD.cash_out as user_cash_out,
	SUD.node_num as user_nodes_num,
	IFNULL(SD.cashout ,0 )as pool_cashout,
	IFNULL(SD.bzzout ,0)as pool_bzz,
	IFNULL(SD.nodes_num,0) as pool_nodes_num
        FROM
            swarm_user_day SUD
            LEFT  JOIN swarm_day SD
        ON SUD.date = SD.update_date
        WHERE
            SUD.userid = #{userid}
        ORDER BY
            SUD.date ASC
            LIMIT 1, 30
    </select>
    <select id="useNodesList" resultType="com.nixer.nprox.entity.swarm.SwarmNodes">
        SELECT
            SN.*,
            SUN.id as linkid
        FROM
            swarm_nodes SN
                LEFT JOIN swarm_user_nodes SUN ON SN.id = SUN.node_uid
        WHERE
            SUN.userid = '${userid}'
        <if test="state != -1">
            AND SN.`state` = '${state}'
        </if>
    </select>
    <select id="findNodeByAddress" resultType="java.lang.Integer">
        select count(*) from  swarm_nodes where  id = #{id}
    </select>
<!--    <select id="findNodeByAddressCanUse" resultType="com.nixer.nprox.entity.swarm.SwarmUserNode">-->
<!--        select * from  swarm_user_nodes WHERE node_uid = #{uid}-->
<!--    </select>-->
    <select id="getNodesNum" resultType="java.lang.Integer">
        select count(*) from  swarm_nodes
    </select>
    <select id="getSysConfigOutCash" resultType="com.nixer.nprox.entity.common.SysConfig">
        select  * from  sys_config where  id = 2
    </select>


</mapper>
